{% extends "base.html" %}
{% load static %}
{% load goods_tags %}
{% block content %}
<!--начало поиска и фильтра-->

<main>
  <div class="wrapper">
    <section class="marketplace-description">
      <h1 class="workSans-h4-h3-h2">Browse Marketplace</h1>
      <form
        class="search-form--marketplace"
        role="search"
        action="{% url 'search' %}"
        method="get"
      >
        <input
          class="search-form__input workSans-base"
          type="search"
          name="q"
          placeholder="Good's search"
        />
        <button class="btn-search" type="submit">Search</button>
      </form>
      <a
      href="{% url 'users-cart' %}"
        class="marketplace-description__my-goods-a workSans-btns-h5"
        >My goods<span>({{ total_quantity }})</span></a>
    </section>
    <nav class="sort">
      <div class="sort__nav">
        
        <a  class="workSans-btns-h5" href="{% url 'catalog-all' %}">All goods</a>
        {% tag_categories as categories %} <!--tag_categories это имя функции пользовательского тэга для джанго, мы создали ее в goods.templatetags.goods_tags-->
        {% for category in categories %} <!-- начало цикла словарей из модуля views.py, в данной ситуации categories это функция qwery set из шаблонных тагов  -->
      <li>
        <a class="workSans-btns-h5" href="{% url 'catalog' category.slug %}">{{category.name}}</a>
      </li><br>
          {% endfor %}
      </div>

      <form action="{% if request.GET.q %}{% url 'search' %}{% else %}{% url 'catalog-all' %}{% endif %}"
      method="get"
      class="sort__sorting">
        <button
          type="button"
          class="sort__sorting-btn-open btn btn--Outlined btn--Tertiary workSans-btns"
          tabindex="1"
        >
          Sort by
        </button>
        <ul class="sort__dropdown-menu workSans-btns hidden">
          <li>
            <input
              class="sort__dropdown-menu-switch"
              type="checkbox"
              name="on_sale"
              id="flexRadioDefault"
              value="on"
              {% if request.GET.on_sale == 'on' %}checked{% endif %}
            />
            {% if request.GET.q %}
            <input type="hidden" name="q" value="{{ request.GET.q }}"><!--если пользователь делает поисковый запрос с включенной сортировкой, срабатывает скрыттый ввод, который сохранит все параметры-->
            {% endif %}
            <label for="flexCheckDefault">Discount only</label><!--тут мы реализовали метод, который будет оставлять галочку при сортировке и перемещении по магазину с пункта - по скидке, 2== обязательно!-->
          </li>
          <div class="sort__dropdown-menu-radio-items">
            <li>
              <input
                class="sort__dropdown-menu-switch"
                type="radio"
                name="order_by"
                id="flexRadioDefault1"
                value="default"
                {% if not request.GET.order_by or request.GET.order_by == 'default' %}checked{% endif %}
              /><label for="flexCheckDefault1">No filter</label>
            </li>
            <li>
              <input
                class="sort__dropdown-menu-switch"
                type="radio"
                name="order_by"
                id="flexRadioDefault2"
                value="-price"
                {% if request.GET.order_by == '-price' %}checked{% endif %}
              /><label for="flexCheckDefault2">Expensive first</label>
            </li>
            <li>
              <input
                class="sort__dropdown-menu-switch"
                type="radio"
                name="order_by"
                id="flexRadioDefault3"
                value="price"
                {% if request.GET.order_by == 'price' %}checked{% endif %}
              /><label for="flexCheckDefault3">Cheap first</label>
            </li>
            <button class="btn-sort btn--with-img" type="submit"></button>
          </div>
        </ul>
      </form>

    </nav>
  </div>

  <div class="marketplace-cards--bg">
    <section class="marketplace-cards wrapper">
      <div class="marketplace-cards-cont">
{% for product in goods %}
        <div class="marketplace-card">
          <a class="marketplace-card__a-whith-img" href="{% url 'product' product.slug %}"
          title="Go to description">
            <img
              class="marketplace-card__img"
              src="{{ product.image.url }}"
              alt="Automatic fish feeder"
            />
          </a>
          <div class="marketplace-card__description">
            <a
            href="{% url 'product' product.slug %}"
            title="{{ product.name }}"
            class="marketplace-card__title workSans-h5"
            >
            {{ product.name|truncatechars:20 }} <!--обрезание оборажения более чем 20ти символов на странице-->
            </a>
            <p class="marketplace-card__availability spaceMono-base">
              In stock<span
                class="marketplace-card__quantity spaceMono-base"
                >({{ product.quantity }})</span
              >
            </p>
            <div class="marketplace-card__bottom-cont">
              <div class="marketplace-card__price-cont spaceMono-base">
                {% if product.discount  %} <!-- начало логики для отображения скидки, функция прописана в goods.models,py sell_price -->
                <p class="marketplace-card__crossed-out-price">{{ product.price }}$</p>
                <p class="spaceMono-h4-h3">{{ product.sell_price }}$</p>
                {% else %}
                <p class="spaceMono-h4-h3">{{ product.sell_price }}$</p>
                {% endif %}
              </div>
              <a class="marketplace-card__basket"
              href="{% url 'cart-add' product.slug %}"></a>
            </div>
          </div>
        </div>
{% endfor %}
        
        
      </div>
      <div class="pagination workSans-btns-h5"> <!--начало логики для пагинации-->
        <div class="pagination-numbers">
        {% if page_obj.has_previous %}
        <P class="pagination-numbers"><a class="pagination-numbers" href="?{% change_params page=page_obj.first %}">First page</a></P>
        <a class="pagination-arrow--left" href="?{% change_params page=page_obj.previous %}"></a>
        {% endif %}
        {% for num in page_obj.paginator.page_range %}
          {% if page_obj.number == num %}
          <P class="pagination-numbers"><a href="?{% change_params page=num %}">{{ num }}</a></P>
          {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
          <P class="pagination-numbers"><a href="?{% change_params page=num %}">{{ num }}</a></P>
          {% endif %}
        {% endfor %}
      
        {% if page_obj.has_next %}
        <a class="pagination-arrow--right" href="?{% change_params page=page_obj.next_page_number %}"></a>
        <P class="pagination-numbers"><a href="?{% change_params page=page_obj.paginator.num_pages %}">Last page</a></P>
        {% endif %}
        </div>
      </div>
    </section>
  </div>
</main>

{% endblock content %}